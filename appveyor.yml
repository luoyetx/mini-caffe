version: 1.0.{build}

pull_requests:
  do_not_increment_build_number: true

skip_tags: true
skip_branch_with_pr: true

image: Visual Studio 2013

environment:
  URL_3rdparty: https://www.dropbox.com/s/imis4fbt2r4ywpo/3rdparty.zip?dl=1

install:
  - ps: |
      if (!(Test-Path "3rdparty.zip")) {
        echo "Downloading 3rdparty.zip from ${env:URL_3rdparty}"
        appveyor DownloadFile "${env:URL_3rdparty}" -FileName 3rdparty.zip -Timeout 1200000
      }
  - cmd: |
      7z x %URL_3rdparty% -y -o"%APPVEYOR_BUILD_FOLDER%" >NUL

before_build:
  - cmd: |
      call generatepb.bat

build_script:
  - cmd: |
      mkdir build
      cd build
      cmake .. -G "Visual Studio 12 2013 Win64"
      msbuild mini-caffe.sln /t:Rebuild /p:Configuration=Debug;Platform=x64 /m
      msbuild mini-caffe.sln /t:Rebuild /p:Configuration=Release;Platform=x64 /m

branches:
  only:
    - master

cache:
  - 3rdparty.zip -> appveyor.yml
